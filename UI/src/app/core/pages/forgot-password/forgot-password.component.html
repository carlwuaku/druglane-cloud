<div class="login-container">
    <div class="login-card-wrapper">
        <mat-card class="login-card">
            <mat-card-header>
                <mat-card-title>
                    <div class="flex flex-col gap-1">
                        <div class="flex gap-1 items-center">
                            <mat-icon class="text-primary">lock_reset</mat-icon>
                            <h3 class="app-name">Forgot Password</h3>
                        </div>
                    </div>
                </mat-card-title>
                <mat-card-subtitle>
                    @if (!emailSent()) {
                    <span>Enter your email address to receive a password reset link</span>
                    } @else {
                    <span>Check your email for the reset link</span>
                    }
                </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content class="flex flex-col gap-2">
                @if (!emailSent()) {
                <form (ngSubmit)="sendResetLink()" class="login-form">
                    <div class="form-container">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Email Address</mat-label>
                            <input matInput type="email" [(ngModel)]="email" name="email" required autocomplete="email"
                                placeholder="Enter your email address" (ngModelChange)="email.set($event)">
                            <mat-icon matPrefix>email</mat-icon>
                        </mat-form-field>

                        <div class="button-container">
                            <button mat-raised-button color="primary" type="submit"
                                [disabled]="!isEmailValid || loading()" class="login-button">
                                @if (loading()) {
                                <app-loading diameter="20"></app-loading>
                                }
                                @if (!loading()) {
                                <mat-icon>send</mat-icon>
                                }
                                <span>Send Reset Link</span>
                            </button>
                        </div>

                        <div class="back-to-login">
                            <button mat-button type="button" (click)="backToLogin()" color="accent">
                                <mat-icon>arrow_back</mat-icon>
                                Back to Login
                            </button>
                        </div>
                    </div>
                </form>
                } @else {
                <div class="success-message">
                    <mat-icon class="success-icon">check_circle</mat-icon>
                    <p class="success-text">
                        If an account exists with the email <strong>{{ email() }}</strong>, you will receive a
                        password reset link shortly.
                    </p>
                    <p class="info-text">
                        Please check your email inbox (and spam folder) for the reset link. The link will expire in
                        60 minutes.
                    </p>
                    <div class="button-container">
                        <button mat-raised-button color="primary" (click)="backToLogin()">
                            <mat-icon>arrow_back</mat-icon>
                            Back to Login
                        </button>
                    </div>
                </div>
                }
            </mat-card-content>

            <mat-card-footer>
                <div class="footer-content">
                    <div class="copyright">
                        &copy; Druglane Cloud {{ currentYear }}. All Rights Reserved.
                    </div>
                </div>
            </mat-card-footer>
        </mat-card>
    </div>
</div>